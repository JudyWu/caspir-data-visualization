<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Data Visualization | CASPIR</title>
    <!-- Version 1.1 -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS section -->
    <link rel="stylesheet" type="text/css" href="stylesheets/libraries/normalize.css" media="screen">
    <!-- <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'> -->
    <link rel="stylesheet" href="stylesheets/libraries/bootstrap.min.css">
    <link rel="stylesheet" href="stylesheets/libraries/chartist.min.css">
    <!-- <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css"> -->
    <link rel="stylesheet" type="text/css" href="stylesheets/style.css">
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css"> -->

    <!-- Javascripts section -->
    <script src="javascripts/plugins/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/plugins/jquery.csv-0.71.min.js"></script>
    <script src="javascripts/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script type="text/javascript" src="javascripts/plugins/matchMedia.js"></script>
    <script type="text/javascript" src="javascripts/plugins/matchMedia.addListener.js"></script>
    <!-- <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script> -->
    <script type="text/javascript" src="javascripts/plugins/moment.min.js"></script>
    <script type="text/javascript" src="javascripts/plugins/Chart.min.js"></script>
    <script type="text/javascript" src="javascripts/script.js"></script>
  </head>

  <body class="row">
    <div id="tds-data"></div>
    <div id="survey-data"></div>
    <!-- Additional BC -->
    <div id="clients-data"></div>
      <div id="drink-data"></div>
    <!-------->
    <div id="center-section" class="col-md-10 col-md-offset-1">
      <!-- Header section -->
      <div class="header-section">
        <div class="row">
          <div class="col-sm-4 col-xs-4">
            <h2><img src="images/caspir_app_icon.png" style="width: 1.5em;">CASPIR</h2>
            <footer style="color: gray; font-size: 15px;">Center for Addiction Services and Personalized Interventions Research</footer>
          </div>
          <div class="col-sm-4 col-sm-offset-4 col-xs-4 col-xs-offset-4">
            <img src="images/northwell_health.jpg" style="height: 8em; width: 12em;" class="pull-right">
          </div>
        </div>
      </div>


      <div id="upload-csv-section" class="row">
        <!-- upload description -->
        <div class="col-sm-10 col-sm-offset-1 text-center">
         <div align="center" style="height:100%;margin:auto;"><div id ="SOIDIV_caspir"></div></div>
          <h3>AI Report Data Visualization</h3>
          <p>
            CASPIR lab provides a platform for reading CSV files into data visualized reports. Data are calculated into tables and presented into graphs for researchers/clinicians to access the participant's daily alcohol consumption easier and faster. 
          </p>
          <hr>
        </div>

        <!-- upload button group -->
        <div class="col-sm-8 col-sm-offset-1">
          <form class="form-horizontal">
            <div class="form-group row">
              <!-- <label for="inputEmail" class="col-xs-2 control-label">Email</label>
              <div class="col-xs-10">
                <input type="email" class="form-control" id="inputEmail" placeholder="Enter your email if you would like to receive the report by email">
              </div -->
              <label for="input-participant-ID" class="col-xs-5 control-label">Participant's ID</label>
              <div class="col-xs-7">
                <input type="text" class="form-control" id="input-participant-ID" placeholder="Participant ID">
              </div>
            </div>
            <div class="form-group row">
              <label for="input-report-title" class="col-xs-5 control-label">Report Title</label>
              <div class="col-xs-7">
                <input type="text" class="form-control" id="input-report-title" placeholder="Report title">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-xs-5 control-label" for="tds-file-upload">TDS CSV File*:</label>
              <input class="col-xs-7" type="file" name="File Upload" id="tds-file-upload" accept=".csv" required>
            </div>
            <div class="form-group row">
              <label class="col-xs-5 control-label" for="survey-file-upload">Morning Survey CSV File*:</label>
              <input class="col-xs-7" type="file" name="File Upload" id="survey-file-upload" accept=".csv" required>
            </div>
          </form>
        </div>

        <!-- Calculated Data Input -->
        <div class="col-sm-8 col-sm-offset-1">
          <form class="form-B-data form-horizontal">  
            <div class="form-group row">
              <label class="col-xs-5 control-label" for="MI-change-plan-goal">Goal from MI Change Plan:</label>
              <div class="col-xs-7">
                <input class="form-control" type="text" id="MI-change-plan-goal" placeholder="Goal from MI Change Plan">
              </div>
            </div>          
            <div class="form-group row">
              <label class="col-xs-5 control-label" for="TLFB-summary-info-days">TLFB summary information &#45;&#45; days assessed:</label>
              <div class="col-xs-7">
                <input class="form-control" type="text" id="TLFB-summary-info-days" placeholder="TLFB summary information days assessed">
              </div>
            </div>
           
            <div class="form-group row">
              <label class="col-xs-5 control-label" for="n-drinking-days"># drinking days:</label>
              <div class="col-xs-7">
                <input type="text" class="form-control" id="n-drinking-days" placeholder="# drinking days">
              </div>
            </div>
         
            <div class="form-group row">
              <label class="col-xs-5 control-label" for="n-heavy-drinking-days"># heavy (>4) drinking days:</label>
              <div class="col-xs-7">
                <input type="text" class="form-control" id="n-heavy-drinking-days" placeholder="# heavy (>4) drinking days">
              </div>   
            </div>
         
            <div class="form-group row">
              <label class="col-xs-5 control-label" for="n-std-drinks-per-wk"># std drinks/wk:</label>
              <div class="col-xs-7">
                <input type="text" class="form-control" id="n-std-drinks-per-wk" placeholder="# std drinks/wk">
              </div>
            </div>
          
            <div class="form-group row">
              <label class="col-xs-5 control-label" for="drinks-or-drinking-day">drinks/drinking day:</label>
              <div class="col-xs-7">
                <input type="text" class="form-control" id="drinks-or-drinking-day" placeholder="drinks/drinking day">
              </div>
            </div>
             <div class="form-group row">
              <label class="col-xs-5 control-label" for="input-tds-oney">TDS 1*:</label>
              <div class="col-xs-7">
                <input type="text" class="form-control" id="input-tds-one" placeholder="TDS 1" required>
              </div>
            </div>
             <div class="form-group row">
              <label class="col-xs-5 control-label" for="input-tds-two">TDS 2:</label>
              <div class="col-xs-7">
                <input type="text" class="form-control" id="input-tds-two" placeholder="TDS 2">
              </div>
            </div>
             <div class="form-group row">
              <label class="col-xs-5 control-label" for="input-tds-three">TDS 3:</label>
              <div class="col-xs-7">
                <input type="text" class="form-control" id="input-tds-three" placeholder="TDS 3">
              </div>
            </div>
          </form>
          
          <button id="upload-button" type="button" class="btn btn-lg center-block" style="background-color: #3B9390; color: white; margin-top: 3em; margin-bottom: 3em;">Upload CSV Here
          </button>
          
        </div>

        <!-- CSV requirements -->
        <div class="col-sm-10 col-sm-offset-2">
          <h5>Instructions</h5>
          <p>
            For the report to accurately represent the data, please make sure that your csv files follow the below requirements.
          </p>
          <ol>
            <li>Your CSV file is in the correct format. An alert will pop out stating the sucess of upload.</li>
            <li>Only include data of one participant in both CSV files.</li>
            <li>* indicated field are required.</li>
          </ol>
        </div>
      </div>
      
      <!-- chart section -->
      <div id="chart-section" style="display: none;" class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <div class="extra-margin"></div>
          <h3 class="text-center" id="input-report-title-output"></h3>
          <span id="report-date" class="pull-right"></span>
          <span>Participant's ID: <span id="input-participant-ID-output"></span></span>
        </div>
        <div class="col-sm-10 col-sm-offset-1">
          <div class="extra-margin"></div>
          <div class="thumbnail">
            <!-- <div class="ct-chart ct-perfect-fourth img-responsive" id="ct-chart1"></div> -->
            <canvas id="drinking-over-time-chart" width="450" height="250"></canvas>
          </div>
          <div class="caption">
            <h4>Time vs. Drinking</h4>
            <p>
              The graph above shows the total number of drinking per day through the whole time the participant was in the study. X axis means the day while y axis means the number of drinks. 
            </p>
          </div>
<!--           <hr> -->
        </div>
<!--         <div class="extra-margin"></div> -->
        <div class="col-sm-10 col-sm-offset-1">
          <div class="thumbnail">
           <canvas id="drinking-over-tds-chart" width="450" height="250"></canvas>
          </div>
          <div class="caption">
            <h4>Average drinking vs. TDS</h4>
            <p>
              The graph above shows the average drinking for each TDS throughout the whole study time. X axis means the types of tds while y axis means the number of drinks.
            </p>
          </div>
          <hr>
        </div>
      </div>

      <!-- form section -->
      <div class="row" id="form-section" style="display: none;">
        <div class="col-sm-10 col-sm-offset-1">
          <h4>BSCT Session 1 Patient Information for Therapist</h4>
          <div id="form-A-section">
            <p>A. <b>Goal from MI Change Plan:</b> <span id="MI-change-plan-goal-output"></span></p>
          </div>
          <div id="form-B-section" class="row">
            <p>B. Baseline characteristics:</p>
            <p>a. TDS summary information</p>
            <table id="form-B-table" class="table table-bordered" style="margin-left: 18px; width: 90% !important;">
              <tr>
                <th>TDS (Typical Drinking Situation)</th>
                <th>Typical frequency</th>
                <th>Typical frequency of drinking</th>
                <th>Avg # standard drinks in TDS</th>
                <th>Occurs mostly during</th>
                <th>Motives endorsed (possibly yes or definitely yes)</th>
              </tr>
              <tr>
                <td id="tds1label-output"></td>
                <td id="tds1freq-output"></td>
                <td id="tds1situation-output"></td>
                <td id="tds1amtdrink-output"></td>
                <td id="tds1time-output"></td>
                <td id="tds1motives-output"></td>
              </tr>
              <tr>
                <td id="tds2label-output"></td>
                <td id="tds2freq-output"></td>
                <td id="tds2situation-output"></td>
                <td id="tds2amtdrink-output"></td>
                <td id="tds2time-output"></td>
                <td id="tds2motives-output"></td>
              </tr>
              <tr>
                <td id="tds3label-output"></td>
                <td id="tds3freq-output"></td>
                <td id="tds3situation-output"></td>
                <td id="tds3amtdrink-output"></td>
                <td id="tds3time-output"></td>
                <td id="tds3motives-output"></td>
              </tr>
            </table>
            <div class="form-B-data col-xs-6">
              <p>b. <b>TLFB summary information &#45;&#45; days assessed:</b> <span id="TLFB-summary-info-days-output"></span></p>
              <ul>
                <li><b># drinking days:</b> <span id="n-drinking-days-output"></span></li>
                <li><b># heavy (>4) drinking days:</b> <span id="n-heavy-drinking-days-output"></span></li>
                <li><b># std drinks/wk:</b> <span id="n-std-drinks-per-wk-output"></span></li>
                <li><b>drinks/drinking day:</b> <span id="drinks-or-drinking-day-output"></span></li>
              </ul>
            </div>
            <div class="form-C-section col-xs-6">
              <p>C. Past month drinking (EMA Data)</p>
              <ul>
                <li><b>EMA compliance:</b> <span id="EMA-compliance-output"></span></li>
                <li><b>Average # drinks/drinking day:</b> <span id="average-n-drinking-day-output"></span></li>
                <li><b># heavy (>4) days:</b> <span id="n-heavy-days-output"></span></li>
                <li><b># moderate (1-4) days:</b> <span id="n-moderate-days-output"></span></li>
                <li><b># abstinent days:</b> <span id="n-abstinent-days-output"></span></li>
              </ul>
            </div>
          </div>
          <div id="form-D-section">
            <p>D. Overview of High Risk Situations over past month:</p>
            <table id="form-D-table" class="table table-bordered">
              <tr>
                <th>TDS (Typical Drinking Situation)</th>
                <th>Number of times in TDS</th>
                <th>Number of times drank in TDS</th>
                <th>Avg # standard drinks in TDS</th>
                <!-- <th>Situation reported mostly during:</th> -->
                <th>Average urge in this situation (on a 0-8 scale)</th>
              </tr>
            </table>
            <p>Precentage of answers when excess was reported</p>
            <ul class="excess-list">
              <li><b>Definitely not:</b> <span id="excess-zero-output"></span></li>
              <li><b>Possibly:</b> <span id="excess-one-output"></span></li>
              <li><b>Probably:</b> <span id="excess-two-output"></span></li>
              <li><b>Definitely:</b> <span id="excess-three-output"></span></li>
            </ul>
          </div>
          <div id="funtion-buttons" class="pull-right">
            <!-- <button id="download-png" class="btn btn-success">Download As PNG File</button> -->
            <button id="go-back-button" class="btn btn-primary pull-right">Upload More CSV Files</button>
          </div>
        </div>
      </div>
      <hr>
  <!-- additional BC drink track data-->
          <div class="col-sm-8 col-sm-offset-1">
              <form class="form-horizontal">
                  <div class="form-group row">
                      <label class="col-xs-5 control-label" for="tds-file-upload">Clients CSV File*:</label>
                      <input class="col-xs-7" type="file" name="File Upload" id="clients-file-upload" accept=".csv" required>
                  </div>
                  <div class="form-group row">
                      <label class="col-xs-5 control-label" for="survey-file-upload">Drink Track CSV File*:</label>
                      <input class="col-xs-7" type="file" name="File Upload" id="drink-file-upload" accept=".csv" required>
                  </div>
                  <button id="convert-button" type="button" class="btn btn-lg center-block" style="background-color: #3B9390; color: white; margin-top: 3em; margin-bottom: 3em;">
                      Convert To DrinkTrack
                  </button>

              </form>
          </div>
      <!-- footer section -->
      <footer>
        <span style="text-decoration: none;">Please email <a href="mailto:caspir@northwell.edu?subject=AI%20Report%20Data%20Visualization">CASPIR@northwell.edu</a> here for support/help.</span>
        <span class="pull-right" style="color: #B8B3BA; text-decoration: none;">Copyright is reserved by CASPIR | 2016.</span>
      </footer>
    </div>
    <script type="text/javascript">
        $(document).ready(function(){
            document.getElementById('tds-file-upload').addEventListener('change', upload, false);
            document.getElementById('survey-file-upload').addEventListener('change', upload, false);
            var uploadSection = document.getElementById("upload-csv-section");
            var chartSection = document.getElementById("chart-section");
            var formSection = document.getElementById("form-section");
            var goBack = document.getElementById("go-back-button");

            $("#upload-button").on("click", function(){
                console.log($('#tds-data').data('csv'));
                tdsDataCalculation($('#tds-data').data('csv')); 
                getTheThirtyDaysPeriod($('#survey-data').data('csv'));
                var today = moment().format('MMMM Do, YYYY');
                $("#report-date").html(today);
                collectInputValue();
                uploadSection.style.display = 'none';
                chartSection.style.display = 'block';
                formSection.style.display = 'block';
                // document.querySelector('#ct-chart1').__chartist__.update();
                // document.querySelector('#ct-chart2').__chartist__.update();
            });

            $("#go-back-button").on("click", function() {
                uploadSection.style.display = 'block';
                chartSection.style.display = 'none';
                formSection.style.display = 'none';
            }); 
          
            ////Additional BC
            document.getElementById('clients-file-upload').addEventListener('change', upload, false);
              document.getElementById('drink-file-upload').addEventListener('change', upload, false);
              $("#convert-button").on("click", function () {
                  console.log($('#clients-data').data('csv'));
                  console.log($('#drink-data').data('csv'));
                  convertDrinkTrack($('#clients-data').data('csv'), $('#drink-data').data('csv'));
              });
        });
        
    </script>
  </body>
</html>
